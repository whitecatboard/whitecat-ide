"use strict";goog.provide("FactoryUtils");FactoryUtils.getBlockDefinition=function(b,d,e,a){b=FactoryUtils.cleanBlockType(b);switch(e){case"JSON":var c=FactoryUtils.formatJson_(b,d);break;case"JavaScript":var c=FactoryUtils.formatJavaScript_(b,d,a);break}return c};FactoryUtils.cleanBlockType=function(a){if(!a){return""}return a.replace(/\W/g,"_").replace(/^(\d)/,"_$1")};FactoryUtils.getGeneratorStub=function(d,k){function c(i,j){j=j.toLowerCase().replace(/\W/g,"_");return"  var "+i+"_"+j}var g=k;var b=[];b.push("Blockly."+g+"['"+d.type+"'] = function(block) {");for(var h=0,m;m=d.inputList[h];h++){for(var f=0,l;l=m.fieldRow[f];f++){var a=l.name;if(!a){continue}if(l instanceof Blockly.FieldVariable){b.push(c("variable",a)+" = Blockly."+g+".variableDB_.getName(block.getFieldValue('"+a+"'), Blockly.Variables.NAME_TYPE);")}else{if(l instanceof Blockly.FieldAngle){b.push(c("angle",a)+" = block.getFieldValue('"+a+"');")}else{if(Blockly.FieldDate&&l instanceof Blockly.FieldDate){b.push(c("date",a)+" = block.getFieldValue('"+a+"');")}else{if(l instanceof Blockly.FieldColour){b.push(c("colour",a)+" = block.getFieldValue('"+a+"');")}else{if(l instanceof Blockly.FieldCheckbox){b.push(c("checkbox",a)+" = block.getFieldValue('"+a+"') == 'TRUE';")}else{if(l instanceof Blockly.FieldDropdown){b.push(c("dropdown",a)+" = block.getFieldValue('"+a+"');")}else{if(l instanceof Blockly.FieldNumber){b.push(c("number",a)+" = block.getFieldValue('"+a+"');")}else{if(l instanceof Blockly.FieldTextInput){b.push(c("text",a)+" = block.getFieldValue('"+a+"');")}}}}}}}}}var a=m.name;if(a){if(m.type==Blockly.INPUT_VALUE){b.push(c("value",a)+" = Blockly."+g+".valueToCode(block, '"+a+"', Blockly."+g+".ORDER_ATOMIC);")}else{if(m.type==Blockly.NEXT_STATEMENT){b.push(c("statements",a)+" = Blockly."+g+".statementToCode(block, '"+a+"');")}}}}var e={JavaScript:";",Python:"",PHP:";",Dart:";"};b.push("  // TODO: Assemble "+g+" into code variable.");if(d.outputConnection){b.push("  var code = '...';");b.push("  // TODO: Change ORDER_NONE to the correct strength.");b.push("  return [code, Blockly."+g+".ORDER_NONE];")}else{b.push("  var code = '..."+(e[g]||"")+"\\n';");b.push("  return code;")}b.push("};");return b.join("\n")};FactoryUtils.formatJson_=function(e,d){var k={};k.type=e;var o=[];var l=[];var c=d.getInputTargetBlock("INPUTS");var m=null;while(c){if(!c.disabled&&!c.getInheritedDisabled()){var h=FactoryUtils.getFieldsJson_(c.getInputTargetBlock("FIELDS"));for(var f=0;f<h.length;f++){if(typeof h[f]=="string"){o.push(h[f].replace(/%/g,"%%"))}else{l.push(h[f]);o.push("%"+l.length)}}var n={type:c.type};if(c.type!="input_dummy"){n.name=c.getFieldValue("INPUTNAME")}var a=JSON.parse(FactoryUtils.getOptTypesFrom(c,"TYPE")||"null");if(a){n.check=a}var j=c.getFieldValue("ALIGN");if(j!="LEFT"){n.align=j}l.push(n);o.push("%"+l.length);m=c}c=c.nextConnection&&c.nextConnection.targetBlock()}if(m&&m.type=="input_dummy"){var h=m.getInputTargetBlock("FIELDS");if(h&&FactoryUtils.getFieldsJson_(h).join("").trim()!=""){var j=m.getFieldValue("ALIGN");if(j!="LEFT"){k.lastDummyAlign0=j}l.pop();o.pop()}}k.message0=o.join(" ");if(l.length){k.args0=l}if(d.getFieldValue("INLINE")=="EXT"){k.inputsInline=false}else{if(d.getFieldValue("INLINE")=="INT"){k.inputsInline=true}}switch(d.getFieldValue("CONNECTIONS")){case"LEFT":k.output=JSON.parse(FactoryUtils.getOptTypesFrom(d,"OUTPUTTYPE")||"null");break;case"BOTH":k.previousStatement=JSON.parse(FactoryUtils.getOptTypesFrom(d,"TOPTYPE")||"null");k.nextStatement=JSON.parse(FactoryUtils.getOptTypesFrom(d,"BOTTOMTYPE")||"null");break;case"TOP":k.previousStatement=JSON.parse(FactoryUtils.getOptTypesFrom(d,"TOPTYPE")||"null");break;case"BOTTOM":k.nextStatement=JSON.parse(FactoryUtils.getOptTypesFrom(d,"BOTTOMTYPE")||"null");break}var b=d.getInputTargetBlock("COLOUR");if(b&&!b.disabled){var g=parseInt(b.getFieldValue("HUE"),10);k.colour=g}k.tooltip=FactoryUtils.getTooltipFromRootBlock_(d);k.helpUrl=FactoryUtils.getHelpUrlFromRootBlock_(d);return JSON.stringify(k,null,"  ")};FactoryUtils.formatJavaScript_=function(j,h,f){var b=[];b.push("Blockly.Blocks['"+j+"'] = {");b.push("  init: function() {");var e={input_value:"appendValueInput",input_statement:"appendStatementInput",input_dummy:"appendDummyInput"};var g=h.getInputTargetBlock("INPUTS");while(g){if(!g.disabled&&!g.getInheritedDisabled()){var a="";if(g.type!="input_dummy"){a=JSON.stringify(g.getFieldValue("INPUTNAME"))}b.push("    this."+e[g.type]+"("+a+")");var c=FactoryUtils.getOptTypesFrom(g,"TYPE");if(c){b.push("        .setCheck("+c+")")}var n=g.getFieldValue("ALIGN");if(n!="LEFT"){b.push("        .setAlign(Blockly.ALIGN_"+n+")")}var m=FactoryUtils.getFieldsJs_(g.getInputTargetBlock("FIELDS"));for(var k=0;k<m.length;k++){b.push("        .appendField("+m[k]+")")}b[b.length-1]+=";"}g=g.nextConnection&&g.nextConnection.targetBlock()}if(h.getFieldValue("INLINE")=="EXT"){b.push("    this.setInputsInline(false);")}else{if(h.getFieldValue("INLINE")=="INT"){b.push("    this.setInputsInline(true);")}}switch(h.getFieldValue("CONNECTIONS")){case"LEFT":b.push(FactoryUtils.connectionLineJs_("setOutput","OUTPUTTYPE",f));break;case"BOTH":b.push(FactoryUtils.connectionLineJs_("setPreviousStatement","TOPTYPE",f));b.push(FactoryUtils.connectionLineJs_("setNextStatement","BOTTOMTYPE",f));break;case"TOP":b.push(FactoryUtils.connectionLineJs_("setPreviousStatement","TOPTYPE",f));break;case"BOTTOM":b.push(FactoryUtils.connectionLineJs_("setNextStatement","BOTTOMTYPE",f));break}var d=h.getInputTargetBlock("COLOUR");if(d&&!d.disabled){var l=parseInt(d.getFieldValue("HUE"),10);if(!isNaN(l)){b.push("    this.setColour("+l+");")}}var p=FactoryUtils.getTooltipFromRootBlock_(h);var o=FactoryUtils.getHelpUrlFromRootBlock_(h);b.push("    this.setTooltip('"+p+"');");b.push("    this.setHelpUrl('"+o+"');");b.push("  }");b.push("};");return b.join("\n")};FactoryUtils.connectionLineJs_=function(d,b,a){var c=FactoryUtils.getOptTypesFrom(FactoryUtils.getRootBlock(a),b);if(c){c=", "+c}else{c=""}return"    this."+d+"(true"+c+");"};FactoryUtils.getFieldsJs_=function(d){var g=[];while(d){if(!d.disabled&&!d.getInheritedDisabled()){switch(d.type){case"field_static":g.push(JSON.stringify(d.getFieldValue("TEXT")));break;case"field_input":g.push("new Blockly.FieldTextInput("+JSON.stringify(d.getFieldValue("TEXT"))+"), "+JSON.stringify(d.getFieldValue("FIELDNAME")));break;case"field_number":var h=[Number(d.getFieldValue("VALUE")),Number(d.getFieldValue("MIN")),Number(d.getFieldValue("MAX")),Number(d.getFieldValue("PRECISION"))];if(h[3]==0){h.pop();if(h[2]==Infinity){h.pop();if(h[1]==-Infinity){h.pop()}}}g.push("new Blockly.FieldNumber("+h.join(", ")+"), "+JSON.stringify(d.getFieldValue("FIELDNAME")));break;case"field_angle":g.push("new Blockly.FieldAngle("+parseFloat(d.getFieldValue("ANGLE"))+"), "+JSON.stringify(d.getFieldValue("FIELDNAME")));break;case"field_checkbox":g.push("new Blockly.FieldCheckbox("+JSON.stringify(d.getFieldValue("CHECKED"))+"), "+JSON.stringify(d.getFieldValue("FIELDNAME")));break;case"field_colour":g.push("new Blockly.FieldColour("+JSON.stringify(d.getFieldValue("COLOUR"))+"), "+JSON.stringify(d.getFieldValue("FIELDNAME")));break;case"field_date":g.push("new Blockly.FieldDate("+JSON.stringify(d.getFieldValue("DATE"))+"), "+JSON.stringify(d.getFieldValue("FIELDNAME")));break;case"field_variable":var b=JSON.stringify(d.getFieldValue("TEXT")||null);g.push("new Blockly.FieldVariable("+b+"), "+JSON.stringify(d.getFieldValue("FIELDNAME")));break;case"field_dropdown":var k=[];for(var e=0;e<d.optionList_.length;e++){k[e]=JSON.stringify([d.getUserData(e),d.getFieldValue("CPU"+e)])}if(k.length){g.push("new Blockly.FieldDropdown(["+k.join(", ")+"]), "+JSON.stringify(d.getFieldValue("FIELDNAME")))}break;case"field_image":var a=JSON.stringify(d.getFieldValue("SRC"));var c=Number(d.getFieldValue("WIDTH"));var j=Number(d.getFieldValue("HEIGHT"));var f=JSON.stringify(d.getFieldValue("ALT"));g.push("new Blockly.FieldImage("+a+", "+c+", "+j+", "+f+")");break}}d=d.nextConnection&&d.nextConnection.targetBlock()}return g};FactoryUtils.getFieldsJson_=function(h){var b=[];while(h){if(!h.disabled&&!h.getInheritedDisabled()){switch(h.type){case"field_static":b.push(h.getFieldValue("TEXT"));break;case"field_input":b.push({type:h.type,name:h.getFieldValue("FIELDNAME"),text:h.getFieldValue("TEXT")});break;case"field_number":var g={type:h.type,name:h.getFieldValue("FIELDNAME"),value:parseFloat(h.getFieldValue("VALUE"))};var f=parseFloat(h.getFieldValue("MIN"));if(f>-Infinity){g.min=f}var a=parseFloat(h.getFieldValue("MAX"));if(a<Infinity){g.max=a}var c=parseFloat(h.getFieldValue("PRECISION"));if(c){g.precision=c}b.push(g);break;case"field_angle":b.push({type:h.type,name:h.getFieldValue("FIELDNAME"),angle:Number(h.getFieldValue("ANGLE"))});break;case"field_checkbox":b.push({type:h.type,name:h.getFieldValue("FIELDNAME"),checked:h.getFieldValue("CHECKED")=="TRUE"});break;case"field_colour":b.push({type:h.type,name:h.getFieldValue("FIELDNAME"),colour:h.getFieldValue("COLOUR")});break;case"field_date":b.push({type:h.type,name:h.getFieldValue("FIELDNAME"),date:h.getFieldValue("DATE")});break;case"field_variable":b.push({type:h.type,name:h.getFieldValue("FIELDNAME"),variable:h.getFieldValue("TEXT")||null});break;case"field_dropdown":var d=[];for(var e=0;e<h.optionList_.length;e++){d[e]=[h.getUserData(e),h.getFieldValue("CPU"+e)]}if(d.length){b.push({type:h.type,name:h.getFieldValue("FIELDNAME"),options:d})}break;case"field_image":b.push({type:h.type,src:h.getFieldValue("SRC"),width:Number(h.getFieldValue("WIDTH")),height:Number(h.getFieldValue("HEIGHT")),alt:h.getFieldValue("ALT")});break}}h=h.nextConnection&&h.nextConnection.targetBlock()}return b};FactoryUtils.getOptTypesFrom=function(c,a){var b=FactoryUtils.getTypesFrom_(c,a);if(b.length==0){return undefined}else{if(b.indexOf("null")!=-1){return"null"}else{if(b.length==1){return b[0]}else{return"["+b.join(", ")+"]"}}}};FactoryUtils.getTypesFrom_=function(e,a){var d=e.getInputTargetBlock(a);var b;if(!d||d.disabled){b=[]}else{if(d.type=="type_other"){b=[JSON.stringify(d.getFieldValue("TYPE"))]}else{if(d.type=="type_group"){b=[];for(var f=0;f<d.typeCount_;f++){b=b.concat(FactoryUtils.getTypesFrom_(d,"TYPE"+f))}var c=Object.create(null);for(var f=b.length-1;f>=0;f--){if(c[b[f]]){b.splice(f,1)}c[b[f]]=true}}else{b=[JSON.stringify(d.valueType)]}}}return b};FactoryUtils.getRootBlock=function(a){var d=a.getTopBlocks(false);for(var b=0,c;c=d[b];b++){if(c.type=="factory_base"){return c}}return null};FactoryUtils.hide=function(a){document.getElementById(a).style.display="none"};FactoryUtils.show=function(a){document.getElementById(a).style.display="block"};FactoryUtils.makeInvisible=function(a){document.getElementById(a).visibility="hidden"};FactoryUtils.makeVisible=function(a){document.getElementById(a).visibility="visible"};FactoryUtils.createAndDownloadFile=function(f,e,d){var g=new Blob([f],{type:"text/"+d});var b=new MouseEvent("click",{view:window,bubbles:true,cancelable:false});var c=document.createElement("a");c.href=window.URL.createObjectURL(g);c.download=e;c.textContent="Download file!";c.dispatchEvent(b)};FactoryUtils.getDefinedBlock=function(b,a){a.clear();return a.newBlock(b)};FactoryUtils.getBlockTypeFromJsDefinition=function(b){var a=b.indexOf("['");var c=b.indexOf("']");if(a!=-1&&c!=-1){return b.substring(a+2,c)}else{throw new Error("Could not parse block type out of JavaScript block definition. Brackets normally enclosing block type not found.")}};FactoryUtils.generateCategoryXml=function(f,d){var c=goog.dom.createDom("category");c.setAttribute("name",d);for(var b=0,e;e=f[b];b++){var a=Blockly.Xml.blockToDom(e);a.removeAttribute("id");c.appendChild(a)}return c};FactoryUtils.parseJsBlockDefinitions=function(b){var d=[];var e=b.indexOf("Blockly.Blocks");while(b.indexOf("Blockly.Blocks",e)!=-1){var c=b.indexOf("Blockly.Blocks",e+1);if(c==-1){c=b.length}var a=b.substring(e,c);d.push(a);e=c}return d};FactoryUtils.parseJsonBlockDefinitions=function(e){var f=[];var a=0;var g=0;for(var c=0;c<e.length;c++){var b=e[c];if(b=="{"){a++}else{if(b=="}"){a--;if(a==0&&c>0){var d=e.substring(g,c+1);f.push(d);g=c+1}}}}return f};FactoryUtils.defineAndGetBlockTypes=function(blockDefsString,format){var blockTypes=[];if(format=="JSON"){var blockDefArray=FactoryUtils.parseJsonBlockDefinitions(blockDefsString);for(var i=0,blockDef;blockDef=blockDefArray[i];i++){var json=JSON.parse(blockDef);blockTypes.push(json.type);Blockly.Blocks[json.type]={init:function(){this.jsonInit(json)}}}}else{if(format=="JavaScript"){var blockDefArray=FactoryUtils.parseJsBlockDefinitions(blockDefsString);for(var i=0,blockDef;blockDef=blockDefArray[i];i++){var blockType=FactoryUtils.getBlockTypeFromJsDefinition(blockDef);blockTypes.push(blockType)}eval(blockDefsString)}}return blockTypes};FactoryUtils.injectCode=function(a,c){var b=document.getElementById(c);b.textContent=a;a=b.textContent;a=prettyPrintOne(a,"js");b.innerHTML=a};FactoryUtils.sameBlockXml=function(f,e){if(f.tagName.toLowerCase()!="xml"||e.tagName.toLowerCase()!="xml"){throw new Error("Expected two XML elements, recieved elements with tag names: "+f.tagName+" and "+e.tagName+".")}var d=f.getElementsByTagName("block")[0];var c=e.getElementsByTagName("block")[0];if(!(d&&c)){throw new Error("Could not get find block element in XML.")}var b=Blockly.Xml.domToText(d);var a=Blockly.Xml.domToText(c);b=b.replace(/\s+/g,"");a=a.replace(/\s+/g,"");return b==a};FactoryUtils.hasVariableField=function(a){if(!a){return false}return a.getVars().length>0};FactoryUtils.isProcedureBlock=function(a){return a&&(a.type=="procedures_defnoreturn"||a.type=="procedures_defreturn"||a.type=="procedures_callnoreturn"||a.type=="procedures_callreturn"||a.type=="procedures_ifreturn")};FactoryUtils.savedBlockChanges=function(d){if(BlockFactory.isStarterBlock()){return true}var b=d.getCurrentBlockType();var c=Blockly.Xml.workspaceToDom(BlockFactory.mainWorkspace);if(d.has(b)){var a=d.getBlockXml(b);return FactoryUtils.sameBlockXml(a,c)}return false};FactoryUtils.getTooltipFromRootBlock_=function(b){var a=b.getInputTargetBlock("TOOLTIP");if(a&&!a.disabled){return a.getFieldValue("TEXT")}return""};FactoryUtils.getHelpUrlFromRootBlock_=function(a){var b=a.getInputTargetBlock("HELPURL");if(b&&!b.disabled){return b.getFieldValue("TEXT")}return""};WorkspaceFactoryModel=function(){this.toolboxList=[];this.flyout=new ListElement(ListElement.TYPE_FLYOUT);this.shadowBlocks=[];this.selected=this.flyout;this.hasVariableCategory=false;this.hasProcedureCategory=false;this.preloadXml=Blockly.Xml.textToDom("<xml></xml>");this.options=new Object(null);this.libBlockTypes=[];this.importedBlockTypes=[]};WorkspaceFactoryModel.prototype.hasCategoryByName=function(a){for(var b=0;b<this.toolboxList.length;b++){if(this.toolboxList[b].type==ListElement.TYPE_CATEGORY&&this.toolboxList[b].name==a){return true}}return false};WorkspaceFactoryModel.prototype.hasVariables=function(){return this.hasVariableCategory};WorkspaceFactoryModel.prototype.hasProcedures=function(){return this.hasProcedureCategory};WorkspaceFactoryModel.prototype.hasElements=function(){return this.toolboxList.length>0};WorkspaceFactoryModel.prototype.addElementToList=function(a){this.hasVariableCategory=a.custom=="VARIABLE"?true:this.hasVariableCategory;this.hasProcedureCategory=a.custom=="PROCEDURE"?true:this.hasProcedureCategory;this.toolboxList.push(a);this.flyout=null};WorkspaceFactoryModel.prototype.deleteElementFromList=function(a){if(a<0||a>=this.toolboxList.length){return}this.hasVariableCategory=this.toolboxList[a].custom=="VARIABLE"?false:this.hasVariableCategory;this.hasProcedureCategory=this.toolboxList[a].custom=="PROCEDURE"?false:this.hasProcedureCategory;this.toolboxList.splice(a,1)};WorkspaceFactoryModel.prototype.createDefaultSelectedIfEmpty=function(){if(this.toolboxList.length==0){this.flyout=new ListElement(ListElement.TYPE_FLYOUT);this.selected=this.flyout}};WorkspaceFactoryModel.prototype.moveElementToIndex=function(b,a,c){if(a<0||a>=this.toolboxList.length||c<0||c>=this.toolboxList.length){throw new Error("Index out of bounds when moving element in the model.")}this.deleteElementFromList(c);this.toolboxList.splice(a,0,b)};WorkspaceFactoryModel.prototype.getSelectedId=function(){return this.selected?this.selected.id:null};WorkspaceFactoryModel.prototype.getSelectedName=function(){return this.selected?this.selected.name:null};WorkspaceFactoryModel.prototype.getSelected=function(){return this.selected};WorkspaceFactoryModel.prototype.setSelectedById=function(a){this.selected=this.getElementById(a)};WorkspaceFactoryModel.prototype.getIndexByElementId=function(b){for(var a=0;a<this.toolboxList.length;a++){if(this.toolboxList[a].id==b){return a}}return -1};WorkspaceFactoryModel.prototype.getElementById=function(b){for(var a=0;a<this.toolboxList.length;a++){if(this.toolboxList[a].id==b){return this.toolboxList[a]}}return null};WorkspaceFactoryModel.prototype.getElementByIndex=function(a){if(a<0||a>=this.toolboxList.length){return null}return this.toolboxList[a]};WorkspaceFactoryModel.prototype.getSelectedXml=function(){return this.selected?this.selected.xml:null};WorkspaceFactoryModel.prototype.getToolboxList=function(){return this.toolboxList};WorkspaceFactoryModel.prototype.getCategoryIdByName=function(a){for(var b=0;b<this.toolboxList.length;b++){if(this.toolboxList[b].name==a){return this.toolboxList[b].id}}return null};WorkspaceFactoryModel.prototype.clearToolboxList=function(){this.toolboxList=[];this.hasVariableCategory=false;this.hasProcedureCategory=false;this.shadowBlocks=[];this.selected.xml=Blockly.Xml.textToDom("<xml></xml>")};WorkspaceFactoryModel.prototype.addShadowBlock=function(a){this.shadowBlocks.push(a)};WorkspaceFactoryModel.prototype.removeShadowBlock=function(a){for(var b=0;b<this.shadowBlocks.length;b++){if(this.shadowBlocks[b]==a){this.shadowBlocks.splice(b,1);return}}};WorkspaceFactoryModel.prototype.isShadowBlock=function(a){for(var b=0;b<this.shadowBlocks.length;b++){if(this.shadowBlocks[b]==a){return true}}return false};WorkspaceFactoryModel.prototype.getShadowBlocksInWorkspace=function(b){var c=[];for(var a=0;a<b.length;a++){if(this.isShadowBlock(b[a].id)){c.push(b[a])}}return c};WorkspaceFactoryModel.prototype.addCustomTag=function(b,a){if(b.type!=ListElement.TYPE_CATEGORY){return}if(a=="VARIABLE"){this.hasVariableCategory=true;b.custom="VARIABLE"}else{if(a=="PROCEDURE"){this.hasProcedureCategory=true;b.custom="PROCEDURE"}}};WorkspaceFactoryModel.prototype.savePreloadXml=function(a){this.preloadXml=a};WorkspaceFactoryModel.prototype.getPreloadXml=function(){return this.preloadXml};WorkspaceFactoryModel.prototype.setOptions=function(a){this.options=a};WorkspaceFactoryModel.prototype.getAllUsedBlockTypes=function(){var b=[];var a=function(e,h){var j=e.getElementsByTagName("block");for(var f=0;f<j.length;f++){var g=j[f].getAttribute("type");if(h.indexOf(g)==-1){h.push(g)}}};if(this.flyout){a(this.getSelectedXml(),b)}else{for(var c=0,d;d=this.toolboxList[c];c++){if(d.type==ListElement.TYPE_CATEGORY){a(d.xml,b)}}}a(this.getPreloadXml(),b);return b};WorkspaceFactoryModel.prototype.addImportedBlockTypes=function(a){this.importedBlockTypes=this.importedBlockTypes.concat(a)};WorkspaceFactoryModel.prototype.updateLibBlockTypes=function(a){this.libBlockTypes=a};WorkspaceFactoryModel.prototype.isDefinedBlockType=function(a){var d=StandardCategories.coreBlockTypes.indexOf(a)!=-1;var c=this.libBlockTypes.indexOf(a)!=-1;var b=this.importedBlockTypes.indexOf(a)!=-1;return(d||c||b)};WorkspaceFactoryModel.prototype.hasDefinedBlockTypes=function(c){for(var a=0,b;b=c[a];a++){if(this.isDefinedBlockType(b)){return true}}return false};ListElement=function(a,b){this.type=a;this.xml=Blockly.Xml.textToDom("<xml></xml>");this.name=b?b:null;this.id=Blockly.utils.genUid();this.color=null;this.custom=null};ListElement.TYPE_CATEGORY="category";ListElement.TYPE_SEPARATOR="separator";ListElement.TYPE_FLYOUT="flyout";ListElement.prototype.saveFromWorkspace=function(a){if(this.type==ListElement.TYPE_FLYOUT||this.type==ListElement.TYPE_CATEGORY){this.xml=Blockly.Xml.workspaceToDom(a)}};ListElement.prototype.changeName=function(a){if(this.type!=ListElement.TYPE_CATEGORY){return}this.name=a};ListElement.prototype.changeColor=function(a){if(this.type!=ListElement.TYPE_CATEGORY){return}this.color=a};ListElement.prototype.copy=function(){copy=new ListElement(this.type);copy.id=Blockly.utils.genUid();copy.name=this.name;copy.xml=this.xml;copy.color=this.color;copy.custom=this.custom;return copy};"use strict";goog.provide("StandardCategories");StandardCategories.categoryMap=Object.create(null);StandardCategories.categoryMap.logic=new ListElement(ListElement.TYPE_CATEGORY,"Logic");StandardCategories.categoryMap.logic.xml=Blockly.Xml.textToDom('<xml><block type="controls_if"></block><block type="logic_compare"></block><block type="logic_operation"></block><block type="logic_negate"></block><block type="logic_boolean"></block><block type="logic_null"></block><block type="logic_ternary"></block></xml>');StandardCategories.categoryMap.logic.color="#5C81A6";StandardCategories.categoryMap.loops=new ListElement(ListElement.TYPE_CATEGORY,"Loops");StandardCategories.categoryMap.loops.xml=Blockly.Xml.textToDom('<xml><block type="controls_repeat_ext"><value name="TIMES"><shadow type="math_number"><field name="NUM">10</field></shadow></value></block><block type="controls_whileUntil"></block><block type="controls_for"><value name="FROM"><shadow type="math_number"><field name="NUM">1</field></shadow></value><value name="TO"><shadow type="math_number"><field name="NUM">10</field></shadow></value><value name="BY"><shadow type="math_number"><field name="NUM">1</field></shadow></value></block><block type="controls_forEach"></block><block type="controls_flow_statements"></block></xml>');StandardCategories.categoryMap.loops.color="#5CA65C";StandardCategories.categoryMap.math=new ListElement(ListElement.TYPE_CATEGORY,"Math");StandardCategories.categoryMap.math.xml=Blockly.Xml.textToDom('<xml><block type="math_number"></block><block type="math_arithmetic"><value name="A"><shadow type="math_number"><field name="NUM">1</field></shadow></value><value name="B"><shadow type="math_number"><field name="NUM">1</field></shadow></value></block><block type="math_single"><value name="NUM"><shadow type="math_number"><field name="NUM">9</field></shadow></value></block><block type="math_trig"><value name="NUM"><shadow type="math_number"><field name="NUM">45</field></shadow></value></block><block type="math_constant"></block><block type="math_number_property"><value name="NUMBER_TO_CHECK"><shadow type="math_number"><field name="NUM">0</field></shadow></value></block><block type="math_round"><value name="NUM"><shadow type="math_number"><field name="NUM">3.1</field></shadow></value></block><block type="math_on_list"></block><block type="math_modulo"><value name="DIVIDEND"><shadow type="math_number"><field name="NUM">64</field></shadow></value><value name="DIVISOR"><shadow type="math_number"><field name="NUM">10</field></shadow></value></block><block type="math_constrain"><value name="VALUE"><shadow type="math_number"><field name="NUM">50</field></shadow></value><value name="LOW"><shadow type="math_number"><field name="NUM">1</field></shadow></value><value name="HIGH"><shadow type="math_number"><field name="NUM">100</field></shadow></value></block><block type="math_random_int"><value name="FROM"><shadow type="math_number"><field name="NUM">1</field></shadow></value><value name="TO"><shadow type="math_number"><field name="NUM">100</field></shadow></value></block><block type="math_random_float"></block></xml>');StandardCategories.categoryMap.math.color="#5C68A6";StandardCategories.categoryMap.text=new ListElement(ListElement.TYPE_CATEGORY,"Text");StandardCategories.categoryMap.text.xml=Blockly.Xml.textToDom('<xml><block type="text"></block><block type="text_join"></block><block type="text_append"><value name="TEXT"><shadow type="text"></shadow></value></block><block type="text_length"><value name="VALUE"><shadow type="text"><field name="TEXT">abc</field></shadow></value></block><block type="text_isEmpty"><value name="VALUE"><shadow type="text"><field name="TEXT"></field></shadow></value></block><block type="text_indexOf"><value name="VALUE"><block type="variables_get"><field name="VAR">text</field></block></value><value name="FIND"><shadow type="text"><field name="TEXT">abc</field></shadow></value></block><block type="text_charAt"><value name="VALUE"><block type="variables_get"><field name="VAR">text</field></block></value></block><block type="text_getSubstring"><value name="STRING"><block type="variables_get"><field name="VAR">text</field></block></value></block><block type="text_changeCase"><value name="TEXT"><shadow type="text"><field name="TEXT">abc</field></shadow></value></block><block type="text_trim"><value name="TEXT"><shadow type="text"><field name="TEXT">abc</field></shadow></value></block><block type="text_print"><value name="TEXT"><shadow type="text"><field name="TEXT">abc</field></shadow></value></block><block type="text_prompt_ext"><value name="TEXT"><shadow type="text"><field name="TEXT">abc</field></shadow></value></block></xml>');StandardCategories.categoryMap.text.color="#5CA68D";StandardCategories.categoryMap.lists=new ListElement(ListElement.TYPE_CATEGORY,"Lists");StandardCategories.categoryMap.lists.xml=Blockly.Xml.textToDom('<xml><block type="lists_create_with"><mutation items="0"></mutation></block><block type="lists_create_with"></block><block type="lists_repeat"><value name="NUM"><shadow type="math_number"><field name="NUM">5</field></shadow></value></block><block type="lists_length"></block><block type="lists_isEmpty"></block><block type="lists_indexOf"><value name="VALUE"><block type="variables_get"><field name="VAR">list</field></block></value></block><block type="lists_getIndex"><value name="VALUE"><block type="variables_get"><field name="VAR">list</field></block></value></block><block type="lists_setIndex"><value name="LIST"><block type="variables_get"><field name="VAR">list</field></block></value></block><block type="lists_getSublist"><value name="LIST"><block type="variables_get"><field name="VAR">list</field></block></value></block><block type="lists_split"><value name="DELIM"><shadow type="text"><field name="TEXT">,</field></shadow></value></block><block type="lists_sort"></block></xml>');StandardCategories.categoryMap.lists.color="#745CA6";StandardCategories.categoryMap.colour=new ListElement(ListElement.TYPE_CATEGORY,"Colour");StandardCategories.categoryMap.colour.xml=Blockly.Xml.textToDom('<xml><block type="colour_picker"></block><block type="colour_random"></block><block type="colour_rgb"><value name="RED"><shadow type="math_number"><field name="NUM">100</field></shadow></value><value name="GREEN"><shadow type="math_number"><field name="NUM">50</field></shadow></value><value name="BLUE"><shadow type="math_number"><field name="NUM">0</field></shadow></value></block><block type="colour_blend"><value name="COLOUR1"><shadow type="colour_picker"><field name="COLOUR">#ff0000</field></shadow></value><value name="COLOUR2"><shadow type="colour_picker"><field name="COLOUR">#3333ff</field></shadow></value><value name="RATIO"><shadow type="math_number"><field name="NUM">0.5</field></shadow></value></block></xml>');StandardCategories.categoryMap.colour.color="#A6745C";StandardCategories.categoryMap.functions=new ListElement(ListElement.TYPE_CATEGORY,"Functions");StandardCategories.categoryMap.functions.color="#9A5CA6";StandardCategories.categoryMap.functions.custom="PROCEDURE";StandardCategories.categoryMap.variables=new ListElement(ListElement.TYPE_CATEGORY,"Variables");StandardCategories.categoryMap.variables.color="#A65C81";StandardCategories.categoryMap.variables.custom="VARIABLE";StandardCategories.coreBlockTypes=["controls_if","logic_compare","logic_operation","logic_negate","logic_boolean","logic_null","logic_ternary","controls_repeat_ext","controls_whileUntil","controls_for","controls_forEach","controls_flow_statements","math_number","math_arithmetic","math_single","math_trig","math_constant","math_number_property","math_change","math_round","math_on_list","math_modulo","math_constrain","math_random_int","math_random_float","text","text_join","text_append","text_length","text_isEmpty","text_indexOf","variables_get","text_charAt","text_getSubstring","text_changeCase","text_trim","text_print","text_prompt_ext","colour_picker","colour_random","colour_rgb","colour_blend","lists_create_with","lists_repeat","lists_length","lists_isEmpty","lists_indexOf","lists_getIndex","lists_setIndex","lists_getSublist","lists_split","lists_sort","variables_set","procedures_defreturn","procedures_ifreturn","procedures_defnoreturn","procedures_callreturn"];goog.require("FactoryUtils");goog.require("StandardCategories");WorkspaceFactoryController=function(b,a,c){this.toolbox=document.getElementById(b);this.toolboxWorkspace=Blockly.inject(a,{grid:{spacing:25,length:3,colour:"#ccc",snap:true},media:"../../media/",toolbox:this.toolbox});this.previewWorkspace=Blockly.inject(c,{grid:{spacing:25,length:3,colour:"#ccc",snap:true},media:"../../media/",toolbox:"<xml></xml>",zoom:{controls:true,wheel:true}});this.model=new WorkspaceFactoryModel();this.view=new WorkspaceFactoryView();this.generator=new WorkspaceFactoryGenerator(this.model);this.selectedMode=WorkspaceFactoryController.MODE_TOOLBOX;this.keyEventsEnabled=true;this.hasUnsavedToolboxChanges=false;this.hasUnsavedPreloadChanges=false};WorkspaceFactoryController.MODE_TOOLBOX="toolbox";WorkspaceFactoryController.MODE_PRELOAD="preload";WorkspaceFactoryController.prototype.addCategory=function(){this.transferFlyoutBlocksToCategory();var a=!this.model.hasElements();var b=this.promptForNewCategoryName("Enter the name of your new category:");if(!b){return}this.createCategory(b);this.switchElement(this.model.getCategoryIdByName(b));if(a){this.view.setCategoryOptions(this.model.hasElements());this.generateNewOptions()}this.updatePreview()};WorkspaceFactoryController.prototype.createCategory=function(a){var c=new ListElement(ListElement.TYPE_CATEGORY,a);this.model.addElementToList(c);var b=this.view.addCategoryRow(a,c.id);this.addClickToSwitch(b,c.id)};WorkspaceFactoryController.prototype.addClickToSwitch=function(b,d){var a=this;var c=function(e){return function(){a.switchElement(e)}};this.view.bindClick(b,c(d))};WorkspaceFactoryController.prototype.transferFlyoutBlocksToCategory=function(){if(!this.model.hasElements()&&this.toolboxWorkspace.getAllBlocks().length>0){this.createCategory("Category 1",true);var a=this.model.getCategoryIdByName("Category 1");this.model.setSelectedById(a);this.view.setCategoryTabSelection(a,true);this.view.setCategoryOptions(this.model.hasElements());this.generateNewOptions();this.updatePreview()}};WorkspaceFactoryController.prototype.removeElement=function(){if(!this.model.getSelected()){return}var b=confirm("Are you sure you want to delete the currently selected "+this.model.getSelected().type+"?");if(!b){return}var c=this.model.getSelectedId();var a=this.model.getIndexByElementId(c);this.view.deleteElementRow(c,a);this.model.deleteElementFromList(a);var e=this.model.getElementByIndex(a);if(!e&&this.model.hasElements()){e=this.model.getElementByIndex(a-1)}var d=e?e.id:null;this.clearAndLoadElement(d);if(!d){alert("You currently have no categories or separators. All your blocks will be displayed in a single flyout.");this.toolboxWorkspace.clear();this.toolboxWorkspace.clearUndo();this.model.createDefaultSelectedIfEmpty()}this.updatePreview()};WorkspaceFactoryController.prototype.promptForNewCategoryName=function(a,d){var c=d;do{var b=prompt(a,c);if(!b){return null}c=b}while(this.model.hasCategoryByName(b));return b};WorkspaceFactoryController.prototype.switchElement=function(a){Blockly.Events.disable();if(this.model.getSelectedId()!=null&&a!=null){this.model.getSelected().saveFromWorkspace(this.toolboxWorkspace)}this.clearAndLoadElement(a);Blockly.Events.enable()};WorkspaceFactoryController.prototype.clearAndLoadElement=function(a){if(this.model.getSelectedId()!=null&&a!=null){this.view.setCategoryTabSelection(this.model.getSelectedId(),false)}if(a!=null){this.model.setSelectedById(a);this.clearAndLoadXml_(this.model.getSelectedXml());this.view.setCategoryTabSelection(a,true);this.toolboxWorkspace.cleanUp();this.view.updateState(this.model.getIndexByElementId(this.model.getSelectedId()),this.model.getSelected())}else{this.view.updateState(-1,null)}};WorkspaceFactoryController.prototype.exportXmlFile=function(b){if(b==WorkspaceFactoryController.MODE_TOOLBOX){var d=prompt("File Name for toolbox XML:","toolbox.xml")}else{var d=prompt("File Name for pre-loaded workspace XML:","workspace.xml")}if(!d){return}if(b==WorkspaceFactoryController.MODE_TOOLBOX){var a=Blockly.Xml.domToPrettyText(this.generator.generateToolboxXml());this.hasUnsavedToolboxChanges=false}else{if(b==WorkspaceFactoryController.MODE_PRELOAD){var a=Blockly.Xml.domToPrettyText(this.generator.generateWorkspaceXml());this.hasUnsavedPreloadChanges=false}else{throw new Error("Unknown export mode: "+b)}}var c=new Blob([a],{type:"text/xml"});this.view.createAndDownloadFile(d,c)};WorkspaceFactoryController.prototype.exportInjectFile=function(){var c=prompt("File Name for starter Blockly workspace code:","workspace.js");if(!c){return}this.generateNewOptions();var a=this.generator.generateInjectString();var b=new Blob([a],{type:"text/javascript"});this.view.createAndDownloadFile(c,b)};WorkspaceFactoryController.prototype.printConfig=function(){this.saveStateFromWorkspace();window.console.log(Blockly.Xml.domToPrettyText(this.generator.generateToolboxXml()))};WorkspaceFactoryController.prototype.updatePreview=function(){Blockly.Events.disable();if(!this.model.options.readOnly){var a=Blockly.Options.parseToolboxTree(this.generator.generateToolboxXml());if(a.getElementsByTagName("category").length==0){if(this.previewWorkspace.toolbox_){this.reinjectPreview(a)}else{this.previewWorkspace.updateToolbox(a)}}else{if(!this.previewWorkspace.toolbox_){this.reinjectPreview(a)}else{this.previewWorkspace.toolbox_.clearSelection();this.previewWorkspace.updateToolbox(a)}}}this.previewWorkspace.clear();Blockly.Xml.domToWorkspace(this.generator.generateWorkspaceXml(),this.previewWorkspace);Blockly.Events.enable()};WorkspaceFactoryController.prototype.saveStateFromWorkspace=function(){if(this.selectedMode==WorkspaceFactoryController.MODE_TOOLBOX){if(this.model.getSelectedXml()!=Blockly.Xml.workspaceToDom(this.toolboxWorkspace)){this.hasUnsavedToolboxChanges=true}this.model.getSelected().saveFromWorkspace(this.toolboxWorkspace)}else{if(this.selectedMode==WorkspaceFactoryController.MODE_PRELOAD){if(this.model.getPreloadXml()!=Blockly.Xml.workspaceToDom(this.toolboxWorkspace)){this.hasUnsavedPreloadChanges=true}this.model.savePreloadXml(Blockly.Xml.workspaceToDom(this.toolboxWorkspace))}}};WorkspaceFactoryController.prototype.reinjectPreview=function(a){this.previewWorkspace.dispose();var b=this.readOptions_();b.toolbox=Blockly.Xml.domToPrettyText(a);this.previewWorkspace=Blockly.inject("preview_blocks",b);Blockly.Xml.domToWorkspace(this.generator.generateWorkspaceXml(),this.previewWorkspace)};WorkspaceFactoryController.prototype.changeCategoryName=function(){var b=this.model.getSelected();if(b.type!=ListElement.TYPE_CATEGORY){return}window.foo=b;var a=this.promptForNewCategoryName("What do you want to change this category's name to?",b.name);if(!a){return}b.changeName(a);this.view.updateCategoryName(a,this.model.getSelectedId());this.updatePreview()};WorkspaceFactoryController.prototype.moveElement=function(e){var c=this.model.getSelected();if(!c){return}var d=this.model.getIndexByElementId(c.id);var a=this.model.getIndexByElementId(c.id)+e;var b=this.model.getElementByIndex(a);if(!b){return}this.moveElementToIndex(c,a,d);this.view.updateState(a,this.model.getSelected());this.updatePreview()};WorkspaceFactoryController.prototype.moveElementToIndex=function(b,a,c){this.model.moveElementToIndex(b,a,c);this.view.moveTabToIndex(b.id,a,c)};WorkspaceFactoryController.prototype.changeSelectedCategoryColor=function(a){if(this.model.getSelected().type!=ListElement.TYPE_CATEGORY){return}this.model.getSelected().changeColor(a);this.view.setBorderColor(this.model.getSelectedId(),a);this.updatePreview()};WorkspaceFactoryController.prototype.loadCategory=function(){do{var a=prompt("Enter the name of the category you would like to import (Logic, Loops, Math, Text, Lists, Colour, Variables, or Functions)");if(!a){return}}while(!this.isStandardCategoryName(a));this.loadCategoryByName(a)};WorkspaceFactoryController.prototype.loadCategoryByName=function(b){if(!this.isStandardCategoryName(b)){return}if(this.model.hasVariables()&&b.toLowerCase()=="variables"){alert("A Variables category already exists. You cannot create multiple variables categories.");return}if(this.model.hasProcedures()&&b.toLowerCase()=="functions"){alert("A Functions category already exists. You cannot create multiple functions categories.");return}var c=StandardCategories.categoryMap[b.toLowerCase()];if(this.model.hasCategoryByName(c.name)){alert("You already have a category with the name "+c.name+". Rename your category and try again.");return}this.transferFlyoutBlocksToCategory();var a=!this.model.hasElements();var e=c.copy();this.model.addElementToList(e);var d=this.view.addCategoryRow(e.name,e.id);this.addClickToSwitch(d,e.id);if(e.color){this.view.setBorderColor(e.id,e.color)}this.switchElement(e.id);this.convertShadowBlocks();this.saveStateFromWorkspace();if(a){this.view.setCategoryOptions(this.model.hasElements());this.generateNewOptions()}this.updatePreview()};WorkspaceFactoryController.prototype.loadStandardToolbox=function(){this.loadCategoryByName("Logic");this.loadCategoryByName("Loops");this.loadCategoryByName("Math");this.loadCategoryByName("Text");this.loadCategoryByName("Lists");this.loadCategoryByName("Colour");this.addSeparator();this.loadCategoryByName("Variables");this.loadCategoryByName("Functions")};WorkspaceFactoryController.prototype.isStandardCategoryName=function(a){for(var b in StandardCategories.categoryMap){if(a.toLowerCase()==b){return true}}return false};WorkspaceFactoryController.prototype.addSeparator=function(){this.transferFlyoutBlocksToCategory();var b=new ListElement(ListElement.TYPE_SEPARATOR);this.model.addElementToList(b);var a=this.view.addSeparatorTab(b.id);this.addClickToSwitch(a,b.id);this.switchElement(b.id);this.updatePreview()};WorkspaceFactoryController.prototype.importFile=function(d,c){if(!d){return}Blockly.Events.disable();var b=this;var a=new FileReader();a.onload=function(){try{var f=Blockly.Xml.textToDom(a.result);if(c==WorkspaceFactoryController.MODE_TOOLBOX){b.setMode(WorkspaceFactoryController.MODE_TOOLBOX);var h=b.model.hasElements()||b.toolboxWorkspace.getAllBlocks().length>0;if(h&&!confirm("Are you sure you want to import? You will lose your current toolbox.")){return}b.importToolboxFromTree_(f)}else{if(c==WorkspaceFactoryController.MODE_PRELOAD){b.setMode(WorkspaceFactoryController.MODE_PRELOAD);if(b.toolboxWorkspace.getAllBlocks().length>0&&!confirm("Are you sure you want to import? You will lose your current workspace blocks.")){return}b.importPreloadFromTree_(f)}else{throw new Error("Unknown import mode: "+c)}}}catch(g){alert("Cannot load XML from file.");console.log(g)}finally{Blockly.Events.enable()}};a.readAsText(d)};WorkspaceFactoryController.prototype.importToolboxFromTree_=function(a){this.model.clearToolboxList();this.view.clearToolboxTabs();if(a.getElementsByTagName("category").length==0){Blockly.Xml.domToWorkspace(a,this.toolboxWorkspace);this.toolboxWorkspace.cleanUp();this.convertShadowBlocks();this.view.addEmptyCategoryMessage()}else{for(var d=0,f;f=a.children[d];d++){if(f.tagName=="category"){this.createCategory(f.getAttribute("name"),false);var e=this.model.getElementByIndex(d);this.switchElement(e.id);for(var c=0,b;b=f.children[c];c++){Blockly.Xml.domToBlock(b,this.toolboxWorkspace)}this.toolboxWorkspace.cleanUp();this.convertShadowBlocks();if(f.getAttribute("colour")){e.changeColor(f.getAttribute("colour"));this.view.setBorderColor(e.id,e.color)}if(f.getAttribute("custom")){this.model.addCustomTag(e,f.getAttribute("custom"))}}else{this.addSeparator();this.switchElement(this.model.getElementByIndex(d).id)}}}this.view.updateState(this.model.getIndexByElementId(this.model.getSelectedId()),this.model.getSelected());this.saveStateFromWorkspace();this.view.setCategoryOptions(this.model.hasElements());this.generateNewOptions();this.updatePreview()};WorkspaceFactoryController.prototype.importPreloadFromTree_=function(a){this.clearAndLoadXml_(a);this.model.savePreloadXml(a);this.updatePreview()};WorkspaceFactoryController.prototype.importPreloadFromTree_=function(a){this.clearAndLoadXml_(a);this.model.savePreloadXml(a);this.saveStateFromWorkspace();this.updatePreview()};WorkspaceFactoryController.prototype.importPreloadFromTree_=function(a){this.clearAndLoadXml_(a);this.model.savePreloadXml(a);this.saveStateFromWorkspace();this.updatePreview()};WorkspaceFactoryController.prototype.clearAll=function(){if(!confirm("Are you sure you want to clear all of your work in Workspace Factory?")){return}var a=this.model.hasElements();this.model.clearToolboxList();this.view.clearToolboxTabs();this.model.savePreloadXml(Blockly.Xml.textToDom("<xml></xml>"));this.view.addEmptyCategoryMessage();this.view.updateState(-1,null);this.toolboxWorkspace.clear();this.toolboxWorkspace.clearUndo();this.saveStateFromWorkspace();this.hasUnsavedToolboxChanges=false;this.hasUnsavedPreloadChanges=false;this.view.setCategoryOptions(this.model.hasElements());this.generateNewOptions();this.updatePreview()};WorkspaceFactoryController.prototype.addShadow=function(){if(!Blockly.selected){return}Blockly.selected.setWarningText(null);this.addShadowForBlockAndChildren_(Blockly.selected);this.saveStateFromWorkspace();this.updatePreview()};WorkspaceFactoryController.prototype.addShadowForBlockAndChildren_=function(c){this.view.markShadowBlock(c);this.model.addShadowBlock(c.id);if(FactoryUtils.hasVariableField(c)){c.setWarningText("Cannot make variable blocks shadow blocks.")}var b=c.getChildren();for(var a=0;a<b.length;a++){this.addShadowForBlockAndChildren_(b[a])}};WorkspaceFactoryController.prototype.removeShadow=function(){if(!Blockly.selected){return}this.model.removeShadowBlock(Blockly.selected.id);this.view.unmarkShadowBlock(Blockly.selected);Blockly.selected.setWarningText(null);this.saveStateFromWorkspace();this.updatePreview()};WorkspaceFactoryController.prototype.isUserGenShadowBlock=function(a){return this.model.isShadowBlock(a)};WorkspaceFactoryController.prototype.convertShadowBlocks=function(){var d=this.toolboxWorkspace.getAllBlocks();for(var b=0,c;c=d[b];b++){if(c.isShadow()){c.setShadow(false);var a=c.outputConnection?c.outputConnection.targetConnection:c.previousConnection.targetConnection;if(a){a.setShadowDom(null)}this.model.addShadowBlock(c.id);this.view.markShadowBlock(c)}}};WorkspaceFactoryController.prototype.setMode=function(a){if(this.selectedMode==a){return}if(this.selectedMode==a){return}this.view.setModeSelection(a);this.selectedMode=a;this.view.updateHelpText(a);if(a==WorkspaceFactoryController.MODE_TOOLBOX){this.model.savePreloadXml(Blockly.Xml.workspaceToDom(this.toolboxWorkspace));this.clearAndLoadXml_(this.model.getSelectedXml());this.view.disableWorkspace(this.view.shouldDisableWorkspace(this.model.getSelected()))}else{if(this.model.getSelected()){this.model.getSelected().saveFromWorkspace(this.toolboxWorkspace)}this.clearAndLoadXml_(this.model.getPreloadXml());this.view.disableWorkspace(false)}};WorkspaceFactoryController.prototype.clearAndLoadXml_=function(a){this.toolboxWorkspace.clear();this.toolboxWorkspace.clearUndo();Blockly.Xml.domToWorkspace(a,this.toolboxWorkspace);this.view.markShadowBlocks(this.model.getShadowBlocksInWorkspace(this.toolboxWorkspace.getAllBlocks()));this.warnForUndefinedBlocks_()};WorkspaceFactoryController.prototype.setStandardOptionsAndUpdate=function(){this.view.setBaseOptions();this.view.setCategoryOptions(this.model.hasElements());this.generateNewOptions()};WorkspaceFactoryController.prototype.generateNewOptions=function(){this.model.setOptions(this.readOptions_());this.reinjectPreview(Blockly.Options.parseToolboxTree(this.generator.generateToolboxXml()))};WorkspaceFactoryController.prototype.readOptions_=function(){var c=Object.create(null);var g=document.getElementById("option_readOnly_checkbox").checked;if(g){c.readOnly=true}else{c.collapse=document.getElementById("option_collapse_checkbox").checked;c.comments=document.getElementById("option_comments_checkbox").checked;c.disable=document.getElementById("option_disable_checkbox").checked;if(document.getElementById("option_infiniteBlocks_checkbox").checked){c.maxBlocks=Infinity}else{var j=document.getElementById("option_maxBlocks_number").value;c.maxBlocks=typeof j=="string"?parseInt(j):j}c.trashcan=document.getElementById("option_trashcan_checkbox").checked;c.horizontalLayout=document.getElementById("option_horizontalLayout_checkbox").checked;c.toolboxPosition=document.getElementById("option_toolboxPosition_checkbox").checked?"end":"start"}c.css=document.getElementById("option_css_checkbox").checked;c.media=document.getElementById("option_media_text").value;c.rtl=document.getElementById("option_rtl_checkbox").checked;c.scrollbars=document.getElementById("option_scrollbars_checkbox").checked;c.sounds=document.getElementById("option_sounds_checkbox").checked;c.oneBasedIndex=document.getElementById("option_oneBasedIndex_checkbox").checked;if(document.getElementById("option_grid_checkbox").checked){var a=Object.create(null);var e=document.getElementById("gridOption_spacing_number").value;a.spacing=typeof e=="string"?parseInt(e):e;var h=document.getElementById("gridOption_length_number").value;a.length=typeof h=="string"?parseInt(h):h;a.colour=document.getElementById("gridOption_colour_text").value;if(!g){a.snap=document.getElementById("gridOption_snap_checkbox").checked}c.grid=a}if(document.getElementById("option_zoom_checkbox").checked){var k=Object.create(null);k.controls=document.getElementById("zoomOption_controls_checkbox").checked;k.wheel=document.getElementById("zoomOption_wheel_checkbox").checked;var i=document.getElementById("zoomOption_startScale_number").value;k.startScale=typeof i=="string"?parseFloat(i):i;var f=document.getElementById("zoomOption_maxScale_number").value;k.maxScale=typeof f=="string"?parseFloat(f):f;var d=document.getElementById("zoomOption_minScale_number").value;k.minScale=typeof d=="string"?parseFloat(d):d;var b=document.getElementById("zoomOption_scaleSpeed_number").value;k.scaleSpeed=typeof b=="string"?parseFloat(b):b;c.zoom=k}return c};WorkspaceFactoryController.prototype.importBlocks=function(c,e){var d=c.name;var b=this;var a=new FileReader();a.onload=function(){try{var g=FactoryUtils.defineAndGetBlockTypes(a.result,e);if(b.model.hasDefinedBlockTypes(g)&&!confirm("An imported block uses the same name as a block already in your toolbox. Are you sure you want to override the currently defined block?")){return}var i=b.generator.getDefinedBlocks(g);var f=FactoryUtils.generateCategoryXml(i,d);var j=Math.floor(Math.random()*360);f.setAttribute("colour",j);b.toolbox.appendChild(f);b.toolboxWorkspace.updateToolbox(b.toolbox);b.model.addImportedBlockTypes(g);b.clearAndLoadXml_(Blockly.Xml.workspaceToDom(b.toolboxWorkspace))}catch(h){alert("Cannot read blocks from file.");window.console.log(h)}};a.readAsText(c)};WorkspaceFactoryController.prototype.setBlockLibCategory=function(a,b){var c=document.getElementById("blockLibCategory");a.setAttribute("id","blockLibCategory");a.setAttribute("colour",260);this.toolbox.replaceChild(a,c);this.toolboxWorkspace.toolbox_.clearSelection();this.toolboxWorkspace.updateToolbox(this.toolbox);this.model.updateLibBlockTypes(b);this.clearAndLoadXml_(Blockly.Xml.workspaceToDom(this.toolboxWorkspace))};WorkspaceFactoryController.prototype.getAllUsedBlockTypes=function(){return this.model.getAllUsedBlockTypes()};WorkspaceFactoryController.prototype.isDefinedBlock=function(a){return this.model.isDefinedBlockType(a.type)};WorkspaceFactoryController.prototype.warnForUndefinedBlocks_=function(){var c=this.toolboxWorkspace.getAllBlocks();for(var a=0,b;b=c[a];a++){if(!this.isDefinedBlock(b)){b.setWarningText(b.type+" is not defined (it is not a standard block, \nin your block library, or an imported block)")}}};WorkspaceFactoryController.prototype.hasVariablesCategory=function(){return this.model.hasVariables()};WorkspaceFactoryController.prototype.hasProceduresCategory=function(){return this.model.hasProcedures()};WorkspaceFactoryController.prototype.hasUnsavedChanges=function(){return this.hasUnsavedToolboxChanges||this.hasUnsavedPreloadChanges};"use strict";goog.provide("BlockFactory");BlockFactory.mainWorkspace=null;BlockFactory.previewWorkspace=null;BlockFactory.UNNAMED="unnamed";BlockFactory.oldDir=null;BlockFactory.STARTER_BLOCK_XML_TEXT='<xml><block type="factory_base" deletable="false" movable="false"><value name="TOOLTIP"><block type="text" deletable="false" movable="false"><field name="TEXT"></field></block></value><value name="HELPURL"><block type="text" deletable="false" movable="false"><field name="TEXT"></field></block></value><value name="COLOUR"><block type="colour_hue"><mutation colour="#5b67a5"></mutation><field name="HUE">230</field></block></value></block></xml>';BlockFactory.updateLanguage=function(){var c=FactoryUtils.getRootBlock(BlockFactory.mainWorkspace);if(!c){return}var a=c.getFieldValue("NAME").trim().toLowerCase();if(!a){a=BlockFactory.UNNAMED}var b=FactoryUtils.getBlockDefinition(a,c,"JSON",BlockFactory.mainWorkspace);FactoryUtils.injectCode(b,"languagePre");BlockFactory.updatePreview()};BlockFactory.updatePreview=function(){var d="ltr";if(BlockFactory.oldDir!=d){if(BlockFactory.previewWorkspace){BlockFactory.previewWorkspace.dispose()}var i=d=="rtl";BlockFactory.previewWorkspace=Blockly.inject("preview",{rtl:i,media:Code.folder+"/media/",scrollbars:true});BlockFactory.oldDir=d}BlockFactory.previewWorkspace.clear();var j="JSON";var b=document.getElementById("languagePre").textContent;if(!b.trim()){return}var c=Blockly.Blocks;try{Blockly.Blocks=Object.create(null);for(var a in c){Blockly.Blocks[a]=c[a]}var k=JSON.parse(b);Blockly.Blocks[k.type||BlockFactory.UNNAMED]={init:function(){this.jsonInit(k)}};var f=null;for(var h in Blockly.Blocks){if(typeof Blockly.Blocks[h].init=="function"&&Blockly.Blocks[h]!=c[h]){f=h;break}}if(!f){return}var g=BlockFactory.previewWorkspace.newBlock(f);g.initSvg();g.render();g.setMovable(false);g.setDeletable(false);g.moveBy(15,10);BlockFactory.previewWorkspace.clearUndo();var e=FactoryUtils.getRootBlock(BlockFactory.mainWorkspace);if(StandardCategories.coreBlockTypes.indexOf(f)!=-1){e.setWarningText("A core Blockly block already exists under this name.")}else{if(f=="block_type"){e.setWarningText('You cannot save a block with the default name, "block_type"')}else{e.setWarningText(null)}}}finally{Blockly.Blocks=c}};BlockFactory.showStarterBlock=function(){BlockFactory.mainWorkspace.clear();var a=Blockly.Xml.textToDom(BlockFactory.STARTER_BLOCK_XML_TEXT);Blockly.Xml.domToWorkspace(a,BlockFactory.mainWorkspace)};BlockFactory.isStarterBlock=function(){var a=FactoryUtils.getRootBlock(BlockFactory.mainWorkspace);return !(a.getChildren().length>0||a.getFieldValue("NAME").trim().toLowerCase()!="block_type"||a.getFieldValue("CONNECTIONS")!="NONE"||a.getFieldValue("INLINE")!="AUTO")};"use strict";Blockly.Blocks.factory_base={init:function(){this.setColour(120);this.appendDummyInput().appendField("name").appendField(new Blockly.FieldTextInput("block_type"),"NAME");this.appendStatementInput("INPUTS").setCheck("Input").appendField("inputs");var a=new Blockly.FieldDropdown([["automatic inputs","AUTO"],["external inputs","EXT"],["inline inputs","INT"]]);this.appendDummyInput().appendField(a,"INLINE");a=new Blockly.FieldDropdown([["no connections","NONE"],[" left output","LEFT"],[" top+bottom connections","BOTH"],[" top connection","TOP"],[" bottom connection","BOTTOM"]],function(b){this.sourceBlock_.updateShape_(b);this.sourceBlock_.spawnOutputShadow_(b)});this.appendDummyInput().appendField(a,"CONNECTIONS");this.appendValueInput("TOOLTIP").setCheck("String").appendField("tooltip");this.appendValueInput("HELPURL").setCheck("String").appendField("help url");this.appendValueInput("COLOUR").setCheck("Colour").appendField("colour");this.setTooltip("Build a custom block by plugging\nfields, inputs and other blocks here.");this.setHelpUrl("https://developers.google.com/blockly/guides/create-custom-blocks/block-factory")},mutationToDom:function(){var a=document.createElement("mutation");a.setAttribute("connections",this.getFieldValue("CONNECTIONS"));return a},domToMutation:function(b){var a=b.getAttribute("connections");this.updateShape_(a)},spawnOutputShadow_:function(a){switch(a){case"LEFT":this.connectOutputShadow_("OUTPUTTYPE");break;case"TOP":this.connectOutputShadow_("TOPTYPE");break;case"BOTTOM":this.connectOutputShadow_("BOTTOMTYPE");break;case"BOTH":this.connectOutputShadow_("TOPTYPE");this.connectOutputShadow_("BOTTOMTYPE");break}},connectOutputShadow_:function(b){var a=this.workspace.newBlock("type_null");a.setShadow(true);a.outputConnection.connect(this.getInput(b).connection);a.initSvg();a.render()},updateShape_:function(c){var d=this.getInput("OUTPUTTYPE");var a=this.getInput("TOPTYPE");var b=this.getInput("BOTTOMTYPE");if(c=="LEFT"){if(!d){this.addTypeInput_("OUTPUTTYPE","output type")}}else{if(d){this.removeInput("OUTPUTTYPE")}}if(c=="TOP"||c=="BOTH"){if(!a){this.addTypeInput_("TOPTYPE","top type")}}else{if(a){this.removeInput("TOPTYPE")}}if(c=="BOTTOM"||c=="BOTH"){if(!b){this.addTypeInput_("BOTTOMTYPE","bottom type")}}else{if(b){this.removeInput("BOTTOMTYPE")}}},addTypeInput_:function(b,a){this.appendValueInput(b).setCheck("Type").appendField(a);this.moveInputBefore(b,"COLOUR")}};var FIELD_MESSAGE="fields %1 %2";var FIELD_ARGS=[{type:"field_dropdown",name:"ALIGN",options:[["left","LEFT"],["right","RIGHT"],["centre","CENTRE"]]},{type:"input_statement",name:"FIELDS",check:"Field"}];var TYPE_MESSAGE="type %1";var TYPE_ARGS=[{type:"input_value",name:"TYPE",check:"Type",align:"RIGHT"}];Blockly.Blocks.input_value={init:function(){this.jsonInit({message0:"value input %1 %2",args0:[{type:"field_input",name:"INPUTNAME",text:"NAME"},{type:"input_dummy"}],message1:FIELD_MESSAGE,args1:FIELD_ARGS,message2:TYPE_MESSAGE,args2:TYPE_ARGS,previousStatement:"Input",nextStatement:"Input",colour:210,tooltip:"A value socket for horizontal connections.",helpUrl:"https://www.youtube.com/watch?v=s2_xaEvcVI0#t=71"})},onchange:function(){inputNameCheck(this)}};Blockly.Blocks.input_statement={init:function(){this.jsonInit({message0:"statement input %1 %2",args0:[{type:"field_input",name:"INPUTNAME",text:"NAME"},{type:"input_dummy"}],message1:FIELD_MESSAGE,args1:FIELD_ARGS,message2:TYPE_MESSAGE,args2:TYPE_ARGS,previousStatement:"Input",nextStatement:"Input",colour:210,tooltip:"A statement socket for enclosed vertical stacks.",helpUrl:"https://www.youtube.com/watch?v=s2_xaEvcVI0#t=246"})},onchange:function(){inputNameCheck(this)}};Blockly.Blocks.input_dummy={init:function(){this.jsonInit({message0:"dummy input",message1:FIELD_MESSAGE,args1:FIELD_ARGS,previousStatement:"Input",nextStatement:"Input",colour:210,tooltip:"For adding fields on a separate row with no connections. Alignment options (left, right, centre) apply only to multi-line fields.",helpUrl:"https://www.youtube.com/watch?v=s2_xaEvcVI0#t=293"})}};Blockly.Blocks.field_static={init:function(){this.setColour(160);this.appendDummyInput().appendField("text").appendField(new Blockly.FieldTextInput(""),"TEXT");this.setPreviousStatement(true,"Field");this.setNextStatement(true,"Field");this.setTooltip("Static text that serves as a label.");this.setHelpUrl("https://www.youtube.com/watch?v=s2_xaEvcVI0#t=88")}};Blockly.Blocks.field_input={init:function(){this.setColour(160);this.appendDummyInput().appendField("text input").appendField(new Blockly.FieldTextInput("default"),"TEXT").appendField(",").appendField(new Blockly.FieldTextInput("NAME"),"FIELDNAME");this.setPreviousStatement(true,"Field");this.setNextStatement(true,"Field");this.setTooltip("An input field for the user to enter text.");this.setHelpUrl("https://www.youtube.com/watch?v=s2_xaEvcVI0#t=319")},onchange:function(){fieldNameCheck(this)}};Blockly.Blocks.field_number={init:function(){this.setColour(160);this.appendDummyInput().appendField("numeric input").appendField(new Blockly.FieldNumber(0),"VALUE").appendField(",").appendField(new Blockly.FieldTextInput("NAME"),"FIELDNAME");this.appendDummyInput().appendField("min").appendField(new Blockly.FieldNumber(-Infinity),"MIN").appendField("max").appendField(new Blockly.FieldNumber(Infinity),"MAX").appendField("precision").appendField(new Blockly.FieldNumber(0,0),"PRECISION");this.setPreviousStatement(true,"Field");this.setNextStatement(true,"Field");this.setTooltip("An input field for the user to enter a number.");this.setHelpUrl("https://www.youtube.com/watch?v=s2_xaEvcVI0#t=319")},onchange:function(){fieldNameCheck(this)}};Blockly.Blocks.field_angle={init:function(){this.setColour(160);this.appendDummyInput().appendField("angle input").appendField(new Blockly.FieldAngle("90"),"ANGLE").appendField(",").appendField(new Blockly.FieldTextInput("NAME"),"FIELDNAME");this.setPreviousStatement(true,"Field");this.setNextStatement(true,"Field");this.setTooltip("An input field for the user to enter an angle.");this.setHelpUrl("https://www.youtube.com/watch?v=s2_xaEvcVI0#t=372")},onchange:function(){fieldNameCheck(this)}};Blockly.Blocks.field_dropdown={init:function(){this.appendDummyInput().appendField("dropdown").appendField(new Blockly.FieldTextInput("NAME"),"FIELDNAME");this.optionList_=["text","text","text"];this.updateShape_();this.setPreviousStatement(true,"Field");this.setNextStatement(true,"Field");this.setMutator(new Blockly.Mutator(["field_dropdown_option_text","field_dropdown_option_image"]));this.setColour(160);this.setTooltip("Dropdown menu with a list of options.");this.setHelpUrl("https://www.youtube.com/watch?v=s2_xaEvcVI0#t=386")},mutationToDom:function(b){var a=document.createElement("mutation");a.setAttribute("options",JSON.stringify(this.optionList_));return a},domToMutation:function(a){var c=JSON.parse(a.getAttribute("options"));if(typeof c=="number"){this.optionList_=[];for(var b=0;b<c;b++){this.optionList_.push("text")}}else{this.optionList_=c}this.updateShape_()},decompose:function(d){var a=d.newBlock("field_dropdown_container");a.initSvg();var c=a.getInput("STACK").connection;for(var e=0;e<this.optionList_.length;e++){var b=d.newBlock("field_dropdown_option_"+this.optionList_[e]);b.initSvg();c.connect(b.previousConnection);c=b.nextConnection}return a},compose:function(b){var c=b.getInputTargetBlock("STACK");this.optionList_.length=0;var e=[];while(c){if(c.type=="field_dropdown_option_text"){this.optionList_.push("text")}else{if(c.type=="field_dropdown_option_image"){this.optionList_.push("image")}}e.push([c.userData_,c.cpuData_]);c=c.nextConnection&&c.nextConnection.targetBlock()}this.updateShape_();for(var d=0;d<this.optionList_.length;d++){var a=e[d][0];if(a!==undefined){if(typeof a=="string"){this.setFieldValue(a||"option","USER"+d)}else{this.setFieldValue(a.src,"SRC"+d);this.setFieldValue(a.width,"WIDTH"+d);this.setFieldValue(a.height,"HEIGHT"+d);this.setFieldValue(a.alt,"ALT"+d)}this.setFieldValue(e[d][1]||"OPTIONNAME","CPU"+d)}}},saveConnections:function(a){var b=a.getInputTargetBlock("STACK");var c=0;while(b){b.userData_=this.getUserData(c);b.cpuData_=this.getFieldValue("CPU"+c);c++;b=b.nextConnection&&b.nextConnection.targetBlock()}},updateShape_:function(){var a=0;while(this.getInput("OPTION"+a)){this.removeInput("OPTION"+a);this.removeInput("OPTION_IMAGE"+a,true);a++}var c="https://www.gstatic.com/codesite/ph/images/star_on.gif";for(var a=0;a<=this.optionList_.length;a++){var b=this.optionList_[a];if(b=="text"){this.appendDummyInput("OPTION"+a).appendField("").appendField(new Blockly.FieldTextInput("option"),"USER"+a).appendField(",").appendField(new Blockly.FieldTextInput("OPTIONNAME"),"CPU"+a)}else{if(b=="image"){this.appendDummyInput("OPTION"+a).appendField("").appendField("image").appendField(new Blockly.FieldTextInput(c),"SRC"+a);this.appendDummyInput("OPTION_IMAGE"+a).appendField(" ").appendField("width").appendField(new Blockly.FieldNumber("15",0,NaN,1),"WIDTH"+a).appendField("height").appendField(new Blockly.FieldNumber("15",0,NaN,1),"HEIGHT"+a).appendField("alt text").appendField(new Blockly.FieldTextInput("*"),"ALT"+a).appendField(",").appendField(new Blockly.FieldTextInput("OPTIONNAME"),"CPU"+a)}}}},onchange:function(){if(this.workspace&&this.optionList_.length<1){this.setWarningText("Drop down menu must\nhave at least one option.")}else{fieldNameCheck(this)}},getUserData:function(a){if(this.optionList_[a]=="text"){return this.getFieldValue("USER"+a)}if(this.optionList_[a]=="image"){return{src:this.getFieldValue("SRC"+a),width:Number(this.getFieldValue("WIDTH"+a)),height:Number(this.getFieldValue("HEIGHT"+a)),alt:this.getFieldValue("ALT"+a)}}throw"Unknown dropdown type"}};Blockly.Blocks.field_dropdown_container={init:function(){this.setColour(160);this.appendDummyInput().appendField("add options");this.appendStatementInput("STACK");this.setTooltip("Add, remove, or reorder options\nto reconfigure this dropdown menu.");this.setHelpUrl("https://www.youtube.com/watch?v=s2_xaEvcVI0#t=386");this.contextMenu=false}};Blockly.Blocks.field_dropdown_option_text={init:function(){this.setColour(160);this.appendDummyInput().appendField("text option");this.setPreviousStatement(true);this.setNextStatement(true);this.setTooltip("Add a new text option to the dropdown menu.");this.setHelpUrl("https://www.youtube.com/watch?v=s2_xaEvcVI0#t=386");this.contextMenu=false}};Blockly.Blocks.field_dropdown_option_image={init:function(){this.setColour(160);this.appendDummyInput().appendField("image option");this.setPreviousStatement(true);this.setNextStatement(true);this.setTooltip("Add a new image option to the dropdown menu.");this.setHelpUrl("https://www.youtube.com/watch?v=s2_xaEvcVI0#t=386");this.contextMenu=false}};Blockly.Blocks.field_checkbox={init:function(){this.setColour(160);this.appendDummyInput().appendField("checkbox").appendField(new Blockly.FieldCheckbox("TRUE"),"CHECKED").appendField(",").appendField(new Blockly.FieldTextInput("NAME"),"FIELDNAME");this.setPreviousStatement(true,"Field");this.setNextStatement(true,"Field");this.setTooltip("Checkbox field.");this.setHelpUrl("https://www.youtube.com/watch?v=s2_xaEvcVI0#t=485")},onchange:function(){fieldNameCheck(this)}};Blockly.Blocks.field_colour={init:function(){this.setColour(160);this.appendDummyInput().appendField("colour").appendField(new Blockly.FieldColour("#ff0000"),"COLOUR").appendField(",").appendField(new Blockly.FieldTextInput("NAME"),"FIELDNAME");this.setPreviousStatement(true,"Field");this.setNextStatement(true,"Field");this.setTooltip("Colour input field.");this.setHelpUrl("https://www.youtube.com/watch?v=s2_xaEvcVI0#t=495")},onchange:function(){fieldNameCheck(this)}};Blockly.Blocks.field_date={init:function(){this.setColour(160);this.appendDummyInput().appendField("date").appendField(new Blockly.FieldDate(),"DATE").appendField(",").appendField(new Blockly.FieldTextInput("NAME"),"FIELDNAME");this.setPreviousStatement(true,"Field");this.setNextStatement(true,"Field");this.setTooltip("Date input field.")},onchange:function(){fieldNameCheck(this)}};Blockly.Blocks.field_variable={init:function(){this.setColour(160);this.appendDummyInput().appendField("variable").appendField(new Blockly.FieldTextInput("item"),"TEXT").appendField(",").appendField(new Blockly.FieldTextInput("NAME"),"FIELDNAME");this.setPreviousStatement(true,"Field");this.setNextStatement(true,"Field");this.setTooltip("Dropdown menu for variable names.");this.setHelpUrl("https://www.youtube.com/watch?v=s2_xaEvcVI0#t=510")},onchange:function(){fieldNameCheck(this)}};Blockly.Blocks.field_image={init:function(){this.setColour(160);var a="https://www.gstatic.com/codesite/ph/images/star_on.gif";this.appendDummyInput().appendField("image").appendField(new Blockly.FieldTextInput(a),"SRC");this.appendDummyInput().appendField("width").appendField(new Blockly.FieldNumber("15",0,NaN,1),"WIDTH").appendField("height").appendField(new Blockly.FieldNumber("15",0,NaN,1),"HEIGHT").appendField("alt text").appendField(new Blockly.FieldTextInput("*"),"ALT");this.setPreviousStatement(true,"Field");this.setNextStatement(true,"Field");this.setTooltip("Static image (JPEG, PNG, GIF, SVG, BMP).\nRetains aspect ratio regardless of height and width.\nAlt text is for when collapsed.");this.setHelpUrl("https://www.youtube.com/watch?v=s2_xaEvcVI0#t=567")}};Blockly.Blocks.type_group={init:function(){this.typeCount_=2;this.updateShape_();this.setOutput(true,"Type");this.setMutator(new Blockly.Mutator(["type_group_item"]));this.setColour(230);this.setTooltip("Allows more than one type to be accepted.");this.setHelpUrl("https://www.youtube.com/watch?v=s2_xaEvcVI0#t=677")},mutationToDom:function(b){var a=document.createElement("mutation");a.setAttribute("types",this.typeCount_);return a},domToMutation:function(a){this.typeCount_=parseInt(a.getAttribute("types"),10);this.updateShape_();for(var c=0;c<this.typeCount_;c++){this.removeInput("TYPE"+c)}for(var c=0;c<this.typeCount_;c++){var b=this.appendValueInput("TYPE"+c).setCheck("Type");if(c==0){b.appendField("any of")}}},decompose:function(c){var a=c.newBlock("type_group_container");a.initSvg();var b=a.getInput("STACK").connection;for(var d=0;d<this.typeCount_;d++){var e=c.newBlock("type_group_item");e.initSvg();b.connect(e.previousConnection);b=e.nextConnection}return a},compose:function(a){var e=a.getInputTargetBlock("STACK");var d=[];while(e){d.push(e.valueConnection_);e=e.nextConnection&&e.nextConnection.targetBlock()}for(var c=0;c<this.typeCount_;c++){var b=this.getInput("TYPE"+c).connection.targetConnection;if(b&&d.indexOf(b)==-1){b.disconnect()}}this.typeCount_=d.length;this.updateShape_();for(var c=0;c<this.typeCount_;c++){Blockly.Mutator.reconnect(d[c],this,"TYPE"+c)}},saveConnections:function(a){var d=a.getInputTargetBlock("STACK");var c=0;while(d){var b=this.getInput("TYPE"+c);d.valueConnection_=b&&b.connection.targetConnection;c++;d=d.nextConnection&&d.nextConnection.targetBlock()}},updateShape_:function(){for(var b=0;b<this.typeCount_;b++){if(!this.getInput("TYPE"+b)){var a=this.appendValueInput("TYPE"+b);if(b==0){a.appendField("any of")}}}while(this.getInput("TYPE"+b)){this.removeInput("TYPE"+b);b++}}};Blockly.Blocks.type_group_container={init:function(){this.jsonInit({message0:"add types %1 %2",args0:[{type:"input_dummy"},{type:"input_statement",name:"STACK"}],colour:230,tooltip:"Add, or remove allowed type.",helpUrl:"https://www.youtube.com/watch?v=s2_xaEvcVI0#t=677"})}};Blockly.Blocks.type_group_item={init:function(){this.jsonInit({message0:"type",previousStatement:null,nextStatement:null,colour:230,tooltip:"Add a new allowed type.",helpUrl:"https://www.youtube.com/watch?v=s2_xaEvcVI0#t=677"})}};Blockly.Blocks.type_null={valueType:null,init:function(){this.jsonInit({message0:"any",output:"Type",colour:230,tooltip:"Any type is allowed.",helpUrl:"https://www.youtube.com/watch?v=s2_xaEvcVI0#t=602"})}};Blockly.Blocks.type_boolean={valueType:"Boolean",init:function(){this.jsonInit({message0:"Boolean",output:"Type",colour:230,tooltip:"Booleans (true/false) are allowed.",helpUrl:"https://www.youtube.com/watch?v=s2_xaEvcVI0#t=602"})}};Blockly.Blocks.type_number={valueType:"Number",init:function(){this.jsonInit({message0:"Number",output:"Type",colour:230,tooltip:"Numbers (int/float) are allowed.",helpUrl:"https://www.youtube.com/watch?v=s2_xaEvcVI0#t=602"})}};Blockly.Blocks.type_string={valueType:"String",init:function(){this.jsonInit({message0:"String",output:"Type",colour:230,tooltip:"Strings (text) are allowed.",helpUrl:"https://www.youtube.com/watch?v=s2_xaEvcVI0#t=602"})}};Blockly.Blocks.type_list={valueType:"Array",init:function(){this.jsonInit({message0:"Array",output:"Type",colour:230,tooltip:"Arrays (lists) are allowed.",helpUrl:"https://www.youtube.com/watch?v=s2_xaEvcVI0#t=602"})}};Blockly.Blocks.type_other={init:function(){this.jsonInit({message0:"other %1",args0:[{type:"field_input",name:"TYPE",text:""}],output:"Type",colour:230,tooltip:"Custom type to allow.",helpUrl:"https://www.youtube.com/watch?v=s2_xaEvcVI0#t=702"})}};Blockly.Blocks.colour_hue={init:function(){this.appendDummyInput().appendField("hue:").appendField(new Blockly.FieldAngle("0",this.validator),"HUE");this.setOutput(true,"Colour");this.setTooltip("Paint the block with this colour.");this.setHelpUrl("https://www.youtube.com/watch?v=s2_xaEvcVI0#t=55")},validator:function(b){var a=parseInt(b,10);if(!isNaN(a)){this.sourceBlock_.setColour(a)}},mutationToDom:function(b){var a=document.createElement("mutation");a.setAttribute("colour",this.getColour());return a},domToMutation:function(a){this.setColour(a.getAttribute("colour"))}};function fieldNameCheck(h){if(!h.workspace){return}var b=h.getFieldValue("FIELDNAME").toLowerCase();var d=0;var g=h.workspace.getAllBlocks();for(var c=0,f;f=g[c];c++){var a=f.getFieldValue("FIELDNAME");if(!f.disabled&&!f.getInheritedDisabled()&&a&&a.toLowerCase()==b){d++}}var e=(d>1)?"There are "+d+" field blocks\n with this name.":null;h.setWarningText(e)}function inputNameCheck(h){if(!h.workspace){return}var b=h.getFieldValue("INPUTNAME").toLowerCase();var d=0;var g=h.workspace.getAllBlocks();for(var c=0,f;f=g[c];c++){var a=f.getFieldValue("INPUTNAME");if(!f.disabled&&!f.getInheritedDisabled()&&a&&a.toLowerCase()==b){d++}}var e=(d>1)?"There are "+d+" input blocks\n with this name.":null;h.setWarningText(e)};goog.provide("AppController");goog.require("goog.dom.classlist");goog.require("goog.ui.PopupColorPicker");goog.require("goog.ui.ColorPicker");AppController=function(){};AppController.prototype.addBlockFactoryEventListeners=function(){BlockFactory.mainWorkspace.addChangeListener(BlockFactory.updateLanguage);BlockFactory.mainWorkspace.addChangeListener(Blockly.Events.disableOrphans)};AppController.prototype.onresize=function(b){var e=500;var i=150;var f=0;var l=22;var c=0;var d;var i;var k;var a=document.getElementById("content_area");var m=Code.getBBox_(a);var h=document.getElementById("block_editor_tool");toolTop=0;h.style.top=toolTop+"px";h.style.left=m.x+"px";h.style.height=(m.height)+"px";h.style.width=e+"px";var n=document.getElementById("block_editor_options");n.style.top=f+"px";n.style.left=(m.x+e)+"px";n.style.height=(l)+"px";n.style.width=e+"px";var j=document.getElementById("preview");c=l;j.style.top=c+"px";d=m.x+e;j.style.left=(m.x+e)+"px";j.style.height=i+"px";j.style.width=(m.width-parseInt(j.style.left.replace("px","")))+"px";var g=document.getElementById("block_editor_code");k=l+i;g.style.top=(k)+"px";g.style.left=(m.x+e)+"px";g.style.height=(m.height-k)+"px";g.style.width=(m.width-d)+"px"};AppController.prototype.init=function(){var a=this;var c="";var b=0;for(var e in Code.lib.def.blocks){c+="<option "+(b==0?"selected":"")+'value="'+Code.lib.def.blocks[e].spec.type+'">'+Code.lib.def.blocks[e].spec.type+"</option>";b++}jQuery("#content_block_editor_type").html(c);jQuery("#content_block_editor_type").on("change",function(){var f=jQuery(this.selectedOptions).val();for(var h in Code.lib.def.blocks){if(Code.lib.def.blocks[h].spec.type==f){var g=atob(Code.lib.def.blocks[h].code);Code.workspace.block_editorCode.setValue(g,-1);Code.workspace.block_editorCode.focus()}}});jQuery("#content_block_editor_type").trigger("change");this.onresize();window.addEventListener("resize",function(){a.onresize()});var d=document.getElementById("blockfactory_toolbox");BlockFactory.mainWorkspace=Blockly.inject("block_editor_tool",{collapse:false,toolbox:d,media:Code.folder+"/media/"});if("BlocklyStorage" in window&&window.location.hash.length>1){BlocklyStorage.retrieveXml(window.location.hash.substring(1),BlockFactory.mainWorkspace)}else{BlockFactory.showStarterBlock()}BlockFactory.mainWorkspace.clearUndo();this.addBlockFactoryEventListeners()};